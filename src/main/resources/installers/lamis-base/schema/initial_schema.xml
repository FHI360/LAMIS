<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>

    <!--
        LAMIS core tables.
        The initial schema has the '00000000000001' id, so that it is over-written if we re-generate it.
    -->

    <changeSet author="mattae" id="20210120232001-00">
        <sql>
            CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
        </sql>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-01">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="country"/>
            </not>
        </preConditions>
        <createTable tableName="country">
            <column autoIncrement="true" name="id" type="serial">
                <constraints primaryKey="true" primaryKeyName="countryPK"/>
            </column>
            <column name="code" type="VARCHAR(4)">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <loadData encoding="UTF-8"
                  file="installers/lamis-base/countries.csv"
                  separator=";"
                  tableName="country"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-02">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="state"/>
            </not>
        </preConditions>
        <createTable tableName="state">
            <column autoIncrement="true" name="id" type="serial">
                <constraints primaryKey="true" primaryKeyName="statePK"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="code" type="VARCHAR(4)">
                <constraints nullable="true"/>
            </column>
            <column name="country_id" type="integer">
                <constraints nullable="true"/>
            </column>
        </createTable>

        <loadData encoding="UTF-8"
                  file="installers/lamis-base/states.csv"
                  separator=";"
                  tableName="state"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-03">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="province"/>
            </not>
        </preConditions>
        <createTable tableName="local_government">
            <column autoIncrement="true" name="id" type="serial">
                <constraints primaryKey="true" primaryKeyName="lgPK"/>
            </column>
            <column name="name" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="state_id" type="integer">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <loadData encoding="UTF-8"
                  file="installers/lamis-base/province.csv"
                  separator=";"
                  tableName="local_government"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-04">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="province"/>
        </preConditions>
        <dropForeignKeyConstraint baseTableName="province" constraintName="fk_province_state_id"/>
        <renameTable oldTableName="province" newTableName="local_government"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-05">
        <preConditions onFail="MARK_RAN">
            <not>
                <foreignKeyConstraintExists foreignKeyName="fk_local_government_state_id"/>
            </not>
        </preConditions>
        <addForeignKeyConstraint baseColumnNames="state_id" baseTableName="local_government"
                                 constraintName="fk_local_government_state_id"
                                 deferrable="false" initiallyDeferred="false" referencedColumnNames="id"
                                 referencedTableName="state"/>

        <addForeignKeyConstraint baseColumnNames="country_id" baseTableName="state" constraintName="fk_state_country_id"
                                 deferrable="false" initiallyDeferred="false" referencedColumnNames="id"
                                 referencedTableName="country"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-10">
        <createTable tableName="module">
            <column name="id" type="serial" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(64)">
                <constraints nullable="false" unique="true" uniqueConstraintName="ux_module_name"/>
            </column>
            <column name="artifact" type="varchar(512)"/>
            <column name="version" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="build_time" type="timestamp"/>
            <column name="base_package" type="varchar(64)">
                <constraints nullable="false"/>
            </column>
            <column name="description" type="varchar(512)"/>
            <column name="active" type="boolean" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="process_config" type="boolean" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="started" type="boolean" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="uninstall" type="boolean" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="data" type="bytea"/>
        </createTable>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-11">
        <createTable tableName="menu">
            <column name="id" type="bigint" autoIncrement="${autoIncrement}">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(64)">
                <constraints nullable="false"/>
            </column>
            <column name="state" type="varchar(256)"/>
            <column name="type" type="varchar(256)">
                <constraints nullable="false"/>
            </column>
            <column name="level" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="position" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="icon" type="varchar(64)"/>
            <column name="tooltip" type="varchar(256)"/>
            <column name="disabled" type="boolean" valueBoolean="false">
                <constraints nullable="false"/>
            </column>
            <column name="module_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="parent_id" type="integer"/>
        </createTable>

        <createTable tableName="menu_authorities">
            <column name="menu_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="authorities" type="varchar(128)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-12">
        <addForeignKeyConstraint baseColumnNames="module_id" baseTableName="menu" constraintName="fk_menu_module_id"
                                 deferrable="false" initiallyDeferred="false" referencedColumnNames="id"
                                 referencedTableName="module"/>

        <addForeignKeyConstraint baseColumnNames="menu_id" baseTableName="menu_authorities"
                                 constraintName="fk_menu_authorities_menu_id"
                                 deferrable="false" initiallyDeferred="false" referencedColumnNames="id"
                                 referencedTableName="menu"/>

        <addForeignKeyConstraint baseColumnNames="parent_id" baseTableName="menu" constraintName="fk_menu_parent_id"
                                 deferrable="false" initiallyDeferred="false" referencedColumnNames="id"
                                 referencedTableName="menu"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-13">
        <createTable tableName="web_remote">
            <column name="id" type="serial" autoIncrement="true">
                <constraints primaryKey="true" primaryKeyName="pkWebRemote" nullable="false"/>
            </column>
            <column name="remote_entry" type="varchar(512)">
                <constraints nullable="false"/>
            </column>
            <column name="remote_name" type="varchar(32)">
                <constraints nullable="false"/>
            </column>
            <column name="module_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="exposed_module">
            <column name="id" type="serial" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pkExposedModule"/>
            </column>
            <column name="name" type="varchar(32)"/>
            <column name="ng_module_name" type="varchar(32)">
                <constraints nullable="false"/>
            </column>
            <column name="route_path" type="varchar(128)">
                <constraints nullable="false"/>
            </column>
            <column name="position" type="int" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="breadcrumb" type="varchar(16)"/>
            <column name="title" type="varchar(64)"/>
            <column name="web_remote_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="exposed_component">
            <column name="id" type="serial" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pkExposedComponent"/>
            </column>
            <column name="exposed_name" type="varchar(32)">
                <constraints nullable="false"/>
            </column>
            <column name="component_name" type="varchar(32)"/>
            <column name="element_name" type="varchar(32)"/>
            <column name="route_path" type="varchar(128)">
                <constraints nullable="false"/>
            </column>
            <column name="position" type="int" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="breadcrumb" type="varchar(16)"/>
            <column name="title" type="varchar(64)"/>
            <column name="web_remote_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="uuid" type="varchar(36)">
                <constraints unique="true"/>
            </column>
        </createTable>

        <createTable tableName="web_component">
            <column name="id" type="varchar(36)" defaultValueComputed="uuid_generate_v4()::text">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pkWebComponent"/>
            </column>
            <column name="name" type="varchar(64)">
                <constraints nullable="false"/>
            </column>
            <column name="type" type="varchar(64)">
                <constraints nullable="false"/>
            </column>
            <column name="component_id" type="varchar(36)">
                <constraints nullable="false" unique="true"/>
            </column>
            <column name="module_id" type="bigint">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="web_module_authorities">
            <column name="module_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="authorities" type="varchar(128)"/>
        </createTable>

        <createTable tableName="component_authorities">
            <column name="component_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="authorities" type="varchar(128)"/>
        </createTable>

        <createTable tableName="web_component_authorities">
            <column name="component_id" type="bigint">
                <constraints nullable="false"/>
            </column>
            <column name="authorities" type="varchar(128)"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="web_module_authorities" baseColumnNames="module_id"
                                 constraintName="fk_web_module_authorities_module_id"
                                 referencedTableName="exposed_module"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="component_authorities" baseColumnNames="component_id"
                                 constraintName="fk_component_authorities_module_id"
                                 referencedTableName="exposed_component"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="exposed_module" baseColumnNames="web_remote_id"
                                 constraintName="fk_exposed_module_web_remote_id" referencedTableName="web_remote"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="exposed_component" baseColumnNames="web_remote_id"
                                 constraintName="fk_exposed_component_web_remote_id" referencedTableName="web_remote"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="web_remote" baseColumnNames="module_id"
                                 constraintName="fk_web_remote_module_id" referencedTableName="module"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="web_component" baseColumnNames="module_id"
                                 constraintName="fk_web_component_module_id" referencedTableName="module"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-15">
        <createTable tableName="form">
            <column name="id" type="varchar(36)" defaultValue="uuid()">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(16)">
                <constraints nullable="false"/>
            </column>
            <column name="priority" type="int" defaultValue="1">
                <constraints nullable="false"/>
            </column>
            <column name="module_id" type="integer">
                <constraints nullable="false"/>
            </column>
            <column name="form_data" type="jsonb"/>
            <column name="component_id" type="varchar(36)">
                <constraints unique="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-16">
        <addForeignKeyConstraint baseTableName="form" baseColumnNames="module_id"
                                 constraintName="fk_form_module_id" referencedTableName="module"
                                 referencedColumnNames="id"/>
    </changeSet>
    <changeSet id="20210120232001-17_2_3_0" author="mattae">
        <sql dbms="postgresql">
            -- Thanks to Patrick Lightbody for submitting this...
            --
            -- In your Quartz properties file, you'll need to set
            -- org.quartz.jobStore.driverDelegateClass = org.quartz.impl.jdbcjobstore.PostgreSQLDelegate

            DROP TABLE IF EXISTS QRTZ_FIRED_TRIGGERS;
            DROP TABLE IF EXISTS QRTZ_PAUSED_TRIGGER_GRPS;
            DROP TABLE IF EXISTS QRTZ_SCHEDULER_STATE;
            DROP TABLE IF EXISTS QRTZ_LOCKS;
            DROP TABLE IF EXISTS QRTZ_SIMPLE_TRIGGERS;
            DROP TABLE IF EXISTS QRTZ_CRON_TRIGGERS;
            DROP TABLE IF EXISTS QRTZ_SIMPROP_TRIGGERS;
            DROP TABLE IF EXISTS QRTZ_BLOB_TRIGGERS;
            DROP TABLE IF EXISTS QRTZ_TRIGGERS;
            DROP TABLE IF EXISTS QRTZ_JOB_DETAILS;
            DROP TABLE IF EXISTS QRTZ_CALENDARS;

            CREATE TABLE QRTZ_JOB_DETAILS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            JOB_NAME VARCHAR(200) NOT NULL,
            JOB_GROUP VARCHAR(200) NOT NULL,
            DESCRIPTION VARCHAR(250) NULL,
            JOB_CLASS_NAME VARCHAR(250) NOT NULL,
            IS_DURABLE BOOL NOT NULL,
            IS_NONCONCURRENT BOOL NOT NULL,
            IS_UPDATE_DATA BOOL NOT NULL,
            REQUESTS_RECOVERY BOOL NOT NULL,
            JOB_DATA BYTEA NULL,
            PRIMARY KEY (SCHED_NAME, JOB_NAME, JOB_GROUP)
            );

            CREATE TABLE QRTZ_TRIGGERS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            TRIGGER_NAME VARCHAR(200) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            JOB_NAME VARCHAR(200) NOT NULL,
            JOB_GROUP VARCHAR(200) NOT NULL,
            DESCRIPTION VARCHAR(250) NULL,
            NEXT_FIRE_TIME BIGINT NULL,
            PREV_FIRE_TIME BIGINT NULL,
            PRIORITY INTEGER NULL,
            TRIGGER_STATE VARCHAR(16) NOT NULL,
            TRIGGER_TYPE VARCHAR(8) NOT NULL,
            START_TIME BIGINT NOT NULL,
            END_TIME BIGINT NULL,
            CALENDAR_NAME VARCHAR(200) NULL,
            MISFIRE_INSTR SMALLINT NULL,
            JOB_DATA BYTEA NULL,
            PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
            FOREIGN KEY (SCHED_NAME, JOB_NAME, JOB_GROUP)
            REFERENCES QRTZ_JOB_DETAILS (SCHED_NAME, JOB_NAME, JOB_GROUP)
            );

            CREATE TABLE QRTZ_SIMPLE_TRIGGERS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            TRIGGER_NAME VARCHAR(200) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            REPEAT_COUNT BIGINT NOT NULL,
            REPEAT_INTERVAL BIGINT NOT NULL,
            TIMES_TRIGGERED BIGINT NOT NULL,
            PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
            FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            );

            CREATE TABLE QRTZ_CRON_TRIGGERS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            TRIGGER_NAME VARCHAR(200) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            CRON_EXPRESSION VARCHAR(120) NOT NULL,
            TIME_ZONE_ID VARCHAR(80),
            PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
            FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            );

            CREATE TABLE QRTZ_SIMPROP_TRIGGERS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            TRIGGER_NAME VARCHAR(200) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            STR_PROP_1 VARCHAR(512) NULL,
            STR_PROP_2 VARCHAR(512) NULL,
            STR_PROP_3 VARCHAR(512) NULL,
            INT_PROP_1 INT NULL,
            INT_PROP_2 INT NULL,
            LONG_PROP_1 BIGINT NULL,
            LONG_PROP_2 BIGINT NULL,
            DEC_PROP_1 NUMERIC(13, 4) NULL,
            DEC_PROP_2 NUMERIC(13, 4) NULL,
            BOOL_PROP_1 BOOL NULL,
            BOOL_PROP_2 BOOL NULL,
            PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
            FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            );

            CREATE TABLE QRTZ_BLOB_TRIGGERS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            TRIGGER_NAME VARCHAR(200) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            BLOB_DATA BYTEA NULL,
            PRIMARY KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP),
            FOREIGN KEY (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            REFERENCES QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP)
            );

            CREATE TABLE QRTZ_CALENDARS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            CALENDAR_NAME VARCHAR(200) NOT NULL,
            CALENDAR BYTEA NOT NULL,
            PRIMARY KEY (SCHED_NAME, CALENDAR_NAME)
            );


            CREATE TABLE QRTZ_PAUSED_TRIGGER_GRPS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            PRIMARY KEY (SCHED_NAME, TRIGGER_GROUP)
            );

            CREATE TABLE QRTZ_FIRED_TRIGGERS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            ENTRY_ID VARCHAR(95) NOT NULL,
            TRIGGER_NAME VARCHAR(200) NOT NULL,
            TRIGGER_GROUP VARCHAR(200) NOT NULL,
            INSTANCE_NAME VARCHAR(200) NOT NULL,
            FIRED_TIME BIGINT NOT NULL,
            SCHED_TIME BIGINT NOT NULL,
            PRIORITY INTEGER NOT NULL,
            STATE VARCHAR(16) NOT NULL,
            JOB_NAME VARCHAR(200) NULL,
            JOB_GROUP VARCHAR(200) NULL,
            IS_NONCONCURRENT BOOL NULL,
            REQUESTS_RECOVERY BOOL NULL,
            PRIMARY KEY (SCHED_NAME, ENTRY_ID)
            );

            CREATE TABLE QRTZ_SCHEDULER_STATE
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            INSTANCE_NAME VARCHAR(200) NOT NULL,
            LAST_CHECKIN_TIME BIGINT NOT NULL,
            CHECKIN_INTERVAL BIGINT NOT NULL,
            PRIMARY KEY (SCHED_NAME, INSTANCE_NAME)
            );

            CREATE TABLE QRTZ_LOCKS
            (
            SCHED_NAME VARCHAR(120) NOT NULL,
            LOCK_NAME VARCHAR(40) NOT NULL,
            PRIMARY KEY (SCHED_NAME, LOCK_NAME)
            );

            CREATE INDEX IDX_QRTZ_J_REQ_RECOVERY
            ON QRTZ_JOB_DETAILS (SCHED_NAME, REQUESTS_RECOVERY);
            CREATE INDEX IDX_QRTZ_J_GRP
            ON QRTZ_JOB_DETAILS (SCHED_NAME, JOB_GROUP);

            CREATE INDEX IDX_QRTZ_T_J
            ON QRTZ_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);
            CREATE INDEX IDX_QRTZ_T_JG
            ON QRTZ_TRIGGERS (SCHED_NAME, JOB_GROUP);
            CREATE INDEX IDX_QRTZ_T_C
            ON QRTZ_TRIGGERS (SCHED_NAME, CALENDAR_NAME);
            CREATE INDEX IDX_QRTZ_T_G
            ON QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);
            CREATE INDEX IDX_QRTZ_T_STATE
            ON QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_STATE);
            CREATE INDEX IDX_QRTZ_T_N_STATE
            ON QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP, TRIGGER_STATE);
            CREATE INDEX IDX_QRTZ_T_N_G_STATE
            ON QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_GROUP, TRIGGER_STATE);
            CREATE INDEX IDX_QRTZ_T_NEXT_FIRE_TIME
            ON QRTZ_TRIGGERS (SCHED_NAME, NEXT_FIRE_TIME);
            CREATE INDEX IDX_QRTZ_T_NFT_ST
            ON QRTZ_TRIGGERS (SCHED_NAME, TRIGGER_STATE, NEXT_FIRE_TIME);
            CREATE INDEX IDX_QRTZ_T_NFT_MISFIRE
            ON QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME);
            CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE
            ON QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_STATE);
            CREATE INDEX IDX_QRTZ_T_NFT_ST_MISFIRE_GRP
            ON QRTZ_TRIGGERS (SCHED_NAME, MISFIRE_INSTR, NEXT_FIRE_TIME, TRIGGER_GROUP, TRIGGER_STATE);

            CREATE INDEX IDX_QRTZ_FT_TRIG_INST_NAME
            ON QRTZ_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME);
            CREATE INDEX IDX_QRTZ_FT_INST_JOB_REQ_RCVRY
            ON QRTZ_FIRED_TRIGGERS (SCHED_NAME, INSTANCE_NAME, REQUESTS_RECOVERY);
            CREATE INDEX IDX_QRTZ_FT_J_G
            ON QRTZ_FIRED_TRIGGERS (SCHED_NAME, JOB_NAME, JOB_GROUP);
            CREATE INDEX IDX_QRTZ_FT_JG
            ON QRTZ_FIRED_TRIGGERS (SCHED_NAME, JOB_GROUP);
            CREATE INDEX IDX_QRTZ_FT_T_G
            ON QRTZ_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_NAME, TRIGGER_GROUP);
            CREATE INDEX IDX_QRTZ_FT_TG
            ON QRTZ_FIRED_TRIGGERS (SCHED_NAME, TRIGGER_GROUP);
        </sql>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-17">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="state" columnName="state_id"/>
        </preConditions>
        <renameColumn tableName="state" oldColumnName="state_id" newColumnName="id"/>
        <renameColumn tableName="lga" oldColumnName="lga_id" newColumnName="id"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-18">
        <createTable tableName="um_role_properties">
            <column name="role_id" type="java.sql.Types.BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="property_name" type="java.sql.Types.VARCHAR(250)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="property_value" type="java.sql.Types.NVARCHAR(2000)"/>
        </createTable>

        <createTable tableName="um_permission_properties">
            <column name="permission_id" type="java.sql.Types.BIGINT">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="property_name" type="java.sql.Types.VARCHAR(250)">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column name="property_value" type="java.sql.Types.NVARCHAR(2000)"/>
        </createTable>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-20">
        <addForeignKeyConstraint baseTableName="um_role_properties"
                                 baseColumnNames="role_id" constraintName="fk_um_rp_r" referencedTableName="um_role"
                                 referencedColumnNames="id"/>

        <addForeignKeyConstraint baseTableName="um_permission_properties"
                                 baseColumnNames="permission_id" constraintName="fk_um_pp_p"
                                 referencedTableName="um_permission"
                                 referencedColumnNames="id"/>
    </changeSet>

    <changeSet author="mattae" id="20210120232001-21">
        <createTable tableName="notification">
            <column name="id" type="serial" autoIncrement="true">
                <constraints nullable="false" primaryKey="true" primaryKeyName="pkNotification"/>
            </column>
            <column name="message" type="varchar(512)">
                <constraints nullable="false"/>
            </column>
            <column name="time" type="timestamp">
                <constraints nullable="false"/>
            </column>
            <column name="route" type="varchar(32)"/>
            <column name="icon" type="varchar(16)"/>
            <column name="read" type="boolean" defaultValue="false">
                <constraints nullable="false"/>
            </column>
            <column name="color" type="varchar(16)" defaultValue="primary">
                <constraints nullable="false"/>
            </column>
            <column name="user_id" type="bigint"/>
        </createTable>

        <addForeignKeyConstraint baseTableName="notification" baseColumnNames="user_id"
                                 constraintName="fk_notification_user_id" referencedTableName="um_user"
                                 referencedColumnNames="id"/>
    </changeSet>

</databaseChangeLog>
